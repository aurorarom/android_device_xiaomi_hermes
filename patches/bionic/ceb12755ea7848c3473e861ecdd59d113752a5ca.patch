From ceb12755ea7848c3473e861ecdd59d113752a5ca Mon Sep 17 00:00:00 2001
From: Adriano Martins <adrianomartins@gmail.com>
Date: Sat, 30 Jan 2016 19:46:01 -0200
Subject: [PATCH] libc : memcpy : allow to disable opt for some targets

Set TARGET_CPU_MEMCPY_OPT_DISABLE feature

Change-Id: Ib30d5e33bdd693a95cd0cc6aba303cf27bbeaa1f
---
 libc/arch-arm/cortex-a53/cortex-a53.mk | 10 +++++++++-
 libc/arch-arm/cortex-a7/cortex-a7.mk   | 10 +++++++++-
 2 files changed, 18 insertions(+), 2 deletions(-)

diff --git a/libc/arch-arm/cortex-a53/cortex-a53.mk b/libc/arch-arm/cortex-a53/cortex-a53.mk
index 3f75ebb..945fece 100644
--- a/libc/arch-arm/cortex-a53/cortex-a53.mk
+++ b/libc/arch-arm/cortex-a53/cortex-a53.mk
@@ -1,5 +1,4 @@
 libc_bionic_src_files_arm += \
-    arch-arm/cortex-a53/bionic/memcpy.S \
     arch-arm/cortex-a53/bionic/__strcat_chk.S \
     arch-arm/cortex-a53/bionic/__strcpy_chk.S \
 
@@ -16,3 +15,12 @@ libc_bionic_src_files_arm += \
 
 libc_bionic_src_files_arm += \
     arch-arm/cortex-a15/bionic/memchr.S
+
+# Optimization not required for some targets
+ifeq ($(TARGET_CPU_MEMCPY_OPT_DISABLE),true)
+libc_bionic_src_files_arm += \
+    arch-arm/cortex-a53/bionic/memcpy.S
+else
+libc_bionic_src_files_arm += \
+    arch-arm/cortex-a15/bionic/memcpy.S
+endif
diff --git a/libc/arch-arm/cortex-a7/cortex-a7.mk b/libc/arch-arm/cortex-a7/cortex-a7.mk
index 646c8b6..f2dffbf 100644
--- a/libc/arch-arm/cortex-a7/cortex-a7.mk
+++ b/libc/arch-arm/cortex-a7/cortex-a7.mk
@@ -3,7 +3,6 @@ libc_bionic_src_files_arm += \
 
 libc_bionic_src_files_arm += \
     arch-arm/cortex-a15/bionic/memchr.S \
-    arch-arm/cortex-a15/bionic/memcpy.S \
     arch-arm/cortex-a15/bionic/strcat.S \
     arch-arm/cortex-a15/bionic/__strcat_chk.S \
     arch-arm/cortex-a15/bionic/strcmp.S \
@@ -16,3 +15,12 @@ libc_bionic_src_files_arm += \
 
 libc_bionic_src_files_arm += \
     arch-arm/denver/bionic/memmove.S \
+
+# Optimization not required for some targets
+ifeq ($(TARGET_CPU_MEMCPY_OPT_DISABLE),true)
+libc_bionic_src_files_arm += \
+    arch-arm/cortex-a7/bionic/memcpy.S
+else
+libc_bionic_src_files_arm += \
+    arch-arm/cortex-a15/bionic/memcpy.S
+endif
\ No newline at end of file
-- 
2.5.0

